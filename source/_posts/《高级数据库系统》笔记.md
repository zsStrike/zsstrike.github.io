---
title: 《高级数据库系统》笔记
date: 2022-09-25 13:39:45
tags: ["数据库", "Database"]
---

本文用于整理《高级数据库系统中》的知识点，以备查阅。

<!-- More -->

## 第一章 数据库系统概述

基本概念：数据，数据库，数据库模式，数据库管理系统，数据库系统。

Megatron 2000 数据库的问题：

+ 元组平铺在磁盘上，删除更新操作代价大
+ 低级的查询处理
+ 无缓冲区管理，IO 代价大
+ 无并发控制，不能保证数据库的一致性
+ 无索引，查询效率低
+ 无故障恢复

数据库模式设计不规范的话会带来很多问题，如数据冗余，更新异常，插入异常，删除异常，可以进行模式分解来解决该问题。

数据库语言类型：DDL，DML，DCL



## 第二章 关系数据库回顾

ANSI/SPARC 体系结构：三级模式结构和两级映像，确保了数据的独立性。

关系模型中的概念：超码，候选码，主码，替换码，外码

关系模型的三类完整性：

+ 实体完整性
+ 参照完整性，可为空
+ 用户自定义完整性

关系代数：并，交，差，笛卡尔积，选择，投影，联接（自然联接和等值连接区别），除



## 第三章 存储介质

存储器访问延迟：

<img src="《高级数据库系统》笔记/memory_latency.jpg" alt="memory_latency" style="zoom: 33%;" />

磁盘结构：盘片，盘面，磁头，磁道，扇区，柱面，扇区之间存在间隙

磁盘块的存取时间：块是 DBMS 中的数据存取的最小单元，扇区是磁盘中数据存储的最小单元

+ 读块延迟：寻道时间 S（平均寻道数） + 旋转延迟 R + 传输时间 T，传输时间是标称传输速率和实际旋转传输时间的较小值
+ 写块延迟：同读块延迟，如果需要校验，则需要再次加上旋转时间和传输时间
+ 块修改：读块 + 写块

块地址包含如下信息：物理设备号，柱面号，盘面号，扇区号

磁盘存取优化：

+ 磁盘调度算法，如电梯调度
+ Random IO to Sequential IO
+ 预取缓冲：单缓冲区，双缓冲区



## 第四章 数据表示

数据项的表示：

<img src="《高级数据库系统》笔记/image-20211213112630434.png" alt="image-20211213112630434" style="zoom: 67%;" />

记录的表示：

+ 固定格式变长记录：定长字段在前，变长字段在后

  <img src="《高级数据库系统》笔记/image-20211213113303828.png" alt="image-20211213113303828" style="zoom: 80%;" />

  

+ 可变格式变长记录：

  ![image-20211213113412716](《高级数据库系统》笔记/image-20211213113412716.png)

记录在块中的组织：

+ 定长记录：使用 <块号,槽号> 表示记录地址

  ![image-20211213113545894](《高级数据库系统》笔记/image-20211213113545894.png)

+ 变长记录：通过槽号获取到记录偏移量和对应的长度

  ![image-20211213113656602](《高级数据库系统》笔记/image-20211213113656602.png)

记录的地址：

+ 逻辑地址：文件号 + 逻辑块地址 + 块内偏移
+ 物理地址：物理块地址 + 块内偏移

记录在块内的操作：

+ 插入：若记录无序，插入到任意块的空闲空间中；若记录有序，找到记录应该放置的块，如果没有空间，可以找邻近块中的空闲空间，或者使用溢出块
+ 删除：立即回收空间，使用删除标记

块在文件中的组织：链表式堆文件组织和目录式堆文件组织



## 第五章 缓冲区管理

缓冲区结构：

+ frame：一些连续的 page，通常等于 page 的大小，包含有 Dirty，PinCount 和 Latch 等信息
+ page：指代在内存中的数据块，操作系统操作文件的单元

>Block, on the other hand, is a group of sectors that the operating system can address;
>
>Page is similar to a block, but is the RAM equivalent. Blocks are usually the smallest unit of “cold” storage, while Pages are usually the smallest unit of in-memory storage.
>
>In some storage systems, chuck could be an abstraction layer above a block.

请求块操作和释放块操作：替换策略，pin 和 unpin，dirty

替换策略：

+ Belady’s （OPT）：理论上最佳的页面置换算法
+ LRU：替换最近最少被访问的 frame
+ LRU-k：考虑 frame 的访问频率，如果某个 frame 的访问次数达到了 K 次以上，则应当尽量不置换
+ 2Q：与 LRU-2 类似，不同之处在于访问 1 次的队列采用 FIFO，而不是 LRU
+ Second-Chance LRU：连续两次置换才能将 frame 替换出去
+ CLOCK：把 Second-Chance FIFO 组织成环形
+ CF-LRU：SSD 上置换算法，减少缓存对闪存的写次数

缓冲管理器：接受上层的 Frame 请求，对 buffer 进行操作和维护，同时向存储管理器发送 Page 相关请求



## 第六章 索引结构

顺序文件上的索引：

+ 密集索引：空间占用大
+ 稀疏索引：点查询性能不如密集索引
+ 多级索引：稀疏二级索引 + 一级索引，一级索引过大时可以再次索引，将二级索引放入内存
+ 主索引：记录在文件中按照主键存储，根据主键建立的主索引
+ 密集辅助索引：非主键上建立的索引，重复键值可以使用间接桶
+ 倒排索引：文档检索

B+ 树：通常 3 层，节点格式 n 个值，n + 1 个指针

+ 叶节点：至少 `(n + 1) / 2` 个指针指向记录，过半记录
+ 中间节点：至少 `(n + 2) / 2` 个指针指向子树，过半指针
+ 根节点：至少两个指针
+ 相关操作：查找，插入（递归分裂），删除（合并，删除叶节点最小值）

散列表：

+ 散列表：查找，插入，删除，注意溢出块的处理
+ 可扩展散列表：前 i 位用于区分桶，索引成倍增加，但对于某个桶来说，只有必要的时候才会分裂
+ 线性散列表：后 i 位用于区分桶，线性增加，只会放在 m 桶或者 $m - 2^{i-1}$ （去掉最高位）桶
  + 填充率：实际记录总数除以桶数（不包括溢出块数量）

多维索引：

+ R-Tree：使用矩形覆盖，建立索引
+ 网格文件：两个维度上建立索引
+ 分段哈希函数



## 第七章 查询优化

查询语句的执行流程：语法分析，逻辑计划生成，查询重写，物理计划生成，物理计划评价，执行物理计划

语法分析：构造语法分析树

逻辑计划生成：将语法分析数转换为代数表达式（逻辑计划）

查询重写：将初始逻辑计划按照转换规则转换，如选择连接顺序，优先选择，先投影后选择等，减少 IO 

查询计划代价估计：T(R)，S(R)，V(R, A)，B(R)

+ $W = R1 × R2$
+ $W = \sigma_{A\ op\ a}(R)$ 
+ $ W = R1\bowtie R2 $

物理操作符间参数传递：物化方式，流水线
